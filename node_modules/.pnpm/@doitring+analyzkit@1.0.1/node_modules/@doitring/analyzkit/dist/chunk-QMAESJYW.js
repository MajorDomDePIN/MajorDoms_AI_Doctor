"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var v=Object.defineProperty;var b=(n,t)=>{for(var e in t)v(n,e,{get:t[e],enumerable:!0})};var R={};b(R,{daily:()=>U,day:()=>O,diff:()=>A,diffs:()=>w,fills:()=>k,hours:()=>j,month:()=>S,time:()=>l,week:()=>E});var _dayjs = require('dayjs'); var _dayjs2 = _interopRequireDefault(_dayjs);var _={};b(_,{arange:()=>p,average:()=>F,format:()=>D,formatEther:()=>T,formatEtherByFormat:()=>H,getTimePoints:()=>M,gte:()=>y,lt:()=>x,parse:()=>Y,percentage:()=>B,plus:()=>V,riposte:()=>I});var _bignumberjs = require('bignumber.js'); var _bignumberjs2 = _interopRequireDefault(_bignumberjs);var _utils = require('ethers-v5/lib/utils');function B(n,t,e=3){return+n==0||+t==0?0:+new (0, _bignumberjs2.default)(t||"0").div(n||"0").times(100).toFixed(e,_bignumberjs2.default.ROUND_DOWN)}function V(n){return n.filter(t=>typeof t<"u").reduce((t,e)=>t.plus(e),new (0, _bignumberjs2.default)(0)).toFixed(0)}function H(n,t=3){return n?D(T(n),t):"0.00"}function T(n="0"){let t=_optionalChain([n, 'access', _2 => _2.toFixed, 'optionalCall', _3 => _3(0)])||_optionalChain([n, 'access', _4 => _4.toString, 'optionalCall', _5 => _5()])||n;return _utils.formatEther.call(void 0, new (0, _bignumberjs2.default)(t==="NaN"?0:t).toFixed(0))}function D(n="0",t=3){let e=Y(n);return`${new (0, _bignumberjs2.default)(n).div(e.v).toFormat(t)}${e.n}`}function y(n,t){return new (0, _bignumberjs2.default)(n).gte(t)}function x(n,t){return new (0, _bignumberjs2.default)(n).lt(t)}function Y(n){let t;for(let e of P){let a=e(new (0, _bignumberjs2.default)(n).toFixed(0));a&&(t=a)}return t||{v:1,d:0,n:""}}function F(n){return n.length===0?0:n.reduce((t,e)=>t+e,0)/n.length}var d={t:{v:10**12,d:13,n:"t"},b:{v:10**9,d:10,n:"b"},m:{v:10**6,d:7,n:"m"}},P=[n=>y(n,d.t.v)&&d.t,n=>y(n,d.b.v)&&x(n,d.t.v)&&d.b,n=>y(n,d.m.v)&&x(n,d.b.v)&&d.m];function I(...n){for(let[t,e]of n)if(t)return e}function p(n,t,e=1,a=[],r=a.length){t||(n-=t=n);for(let u=r+Math.max(Math.ceil((++t-n)/e),0);r<u;n+=e)a[r++]=n;return a}function M(n){let t=[],e=_dayjs2.default.call(void 0, ).startOf("day"),a=_dayjs2.default.call(void 0, ).endOf("day"),r=e;for(;r.isBefore(a)||r.isSame(a,"minute");)t.push(r.format("HH:mm")),r=r.add(n,"second");return t}function O(n,t,e){let a=l(n,t,"d",e),r=_dayjs2.default.unix(n).format("MM/DD"),u=_dayjs2.default.unix(n).format("YYYY-MM-DD");return{date:n,data:a,day:r,ytd:u}}function E(n,t,e){return l(n,t,"w",e)}function S(n,t,e){return l(n,t,"M",e)}function j(n,t=3600){let e=n[n.length-1],a=n[0],r=[_dayjs2.default.unix(_optionalChain([a, 'optionalAccess', _6 => _6.date])||0).startOf("d").unix(),_dayjs2.default.unix(_optionalChain([e, 'optionalAccess', _7 => _7.date])||0).endOf("d").unix()];return p(r[0],r[1],t).map(u=>{let s=_dayjs2.default.unix(u),o=n.filter(i=>i.date>u&&i.date<u+t);return{hour:s.format("HH:mm"),time:s,data:o}})}function U(n){return[...new Set([...n.map(G)])].map(t=>_dayjs2.default.call(void 0, t,"YYYY-MM-DD").unix()).map(t=>O(t,n))}function k(n,t,e,a){let r={h:"hour",w:"day",M:"day"}[e],u=new Map,s=[];if(e==="h"){let o=_dayjs2.default.call(void 0, t[0].hour,"HH:mm"),i=_dayjs2.default.call(void 0, t[1].hour,"HH:mm");s=M(i.diff(o,"seconds")).map(m=>({[r]:m}))}if(e==="M"){let o=_dayjs2.default.unix(n),i=o.daysInMonth();s=p(1,i).map(m=>o.date(m)).map(m=>({[r]:m.format("MM/DD"),ytd:m.format("YYYY-MM-DD"),date:m.unix()}))}if(e==="w"){let o=_dayjs2.default.unix(n);s=p(0,6).map(i=>o.day(i)).map(i=>({[r]:i.format("MM/DD"),ytd:i.format("YYYY-MM-DD"),date:i.unix()}))}for(let o of s)u.set(o[r],{...o,...a});for(let o of t)u.set(o[r],o);return[...u.values()]}function l(n,t,e,a){let r=_optionalChain([a, 'optionalAccess', _8 => _8.difference])||0,u=(_optionalChain([a, 'optionalAccess', _9 => _9.startOf])||_dayjs2.default.unix(n).startOf(e).unix())+r,s=(_optionalChain([a, 'optionalAccess', _10 => _10.endOf])||_dayjs2.default.unix(n).endOf(e).unix())+r;return t.filter(o=>o.date>u&&o.date<s)}function A(n,t,e=3600){let a=w(t,e),r=_dayjs2.default.unix(n).format("YYYY-MM-DD"),u=_dayjs2.default.unix(n).format("MM/DD");return{data:_optionalChain([a, 'access', _11 => _11.find, 'call', _12 => _12(i=>i.ytd===r), 'optionalAccess', _13 => _13.data])||[],ytd:r,date:n,day:u}}function w(n,t=3600,e=!1){let a=[],r=[...n];r.sort((o,i)=>o.date-i.date);let u=[r[0]].filter(Boolean);for(let o=1;o<r.length;o++)r[o].date-u[u.length-1].date<=t?u.push(r[o]):(a.push(u),u=[r[o]]);if(u.length>0&&a.push(u),e)return a.map(o=>{let i=o.at(-1).date,m=_dayjs2.default.unix(i).format("YYYY-MM-DD"),g=_dayjs2.default.unix(i).format("MM/DD");return{date:i,data:o,ytd:m,day:g}});let s=new Map;for(let o of a){let i=o.at(-1).date,m=_dayjs2.default.unix(i).format("YYYY-MM-DD"),g=_dayjs2.default.unix(i).format("MM/DD");(_optionalChain([s, 'access', _14 => _14.get, 'call', _15 => _15(m), 'optionalAccess', _16 => _16.data])||[]).length>o.length||s.set(m,{data:o,date:i,ytd:m,day:g})}return[...s.values()]}function G(n){return _dayjs2.default.unix(n.date).format("YYYY-MM-DD")}exports.a = b; exports.b = B; exports.c = V; exports.d = F; exports.e = I; exports.f = _; exports.g = O; exports.h = E; exports.i = S; exports.j = j; exports.k = U; exports.l = k; exports.m = l; exports.n = A; exports.o = w; exports.p = R;
